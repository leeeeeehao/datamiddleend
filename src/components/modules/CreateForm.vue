<template>
  <a-modal
    title="新建数据源"
    :width="640"
    :visible="visible"
    :confirmLoading="loading"
    @ok="() => { $emit('ok') }"
    @cancel="() => { $emit('cancel') }"
  >
    <a-spin :spinning="loading">
      <a-form :form="form" v-bind="formLayout">
        <!-- 检查是否有 id 并且大于0，大于0是修改。其他是新增，新增不显示主键ID -->
        <a-form-item v-show="model && model.id > 0" label="主键ID">
          <a-input v-decorator="['id', { initialValue: 0 }]" disabled />
        </a-form-item>

        <a-form-item label="连接名称">
          <a-input v-decorator="['name', {rules: [{required: true, min: 1, message: '此项不能为空！'}]}]" />
        </a-form-item>
        <a-form-item label="主机名称">
          <a-input v-decorator="['hostName', {rules: [{required: true, min: 1, message: '此项不能为空！'}]}]" />
        </a-form-item>
        <a-form-item label="数据库名称">
          <a-input v-decorator="['databaseName', {rules: [{required: true, min: 1, message: '此项不能为空！'}]}]" />
        </a-form-item>
        <a-form-item label="数据库类型">
          <a-select
            style="width: 100%"
            @change="handleChange"
            v-decorator="['databaseType', { rules: [{required: true, message: '付款账户必须填写'}] }]">
          >
            <a-select-option value="MySql">
              <svg t="1607485359200" style="margin-top: 4px;margin-right: 4px" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="973" width="5%" height="5%" ><path d="M880.697 737.555c-47.588-1.195-84.475 3.572-115.409 16.653-8.925 3.573-23.203 3.573-24.393 14.876 4.762 4.762 5.357 12.492 9.523 19.037 7.136 11.898 19.628 27.962 30.935 36.29 12.492 9.513 24.988 19.033 38.069 27.362 23.206 14.281 49.383 22.604 71.988 36.885 13.087 8.325 26.173 19.036 39.259 27.962 6.546 4.756 10.707 12.491 19.037 15.465v-1.785c-4.166-5.357-5.357-13.091-9.52-19.037-5.945-5.952-11.897-11.308-17.842-17.253-17.253-23.199-38.67-43.425-61.874-60.086-19.036-13.087-60.679-30.934-68.409-52.944 0 0-0.601-0.595-1.19-1.19 13.087-1.189 28.551-5.946 41.049-9.519 20.223-5.353 38.67-4.162 59.491-9.52 9.513-2.379 19.033-5.351 28.551-8.33v-5.351c-10.707-10.707-18.438-24.983-29.745-35.097-30.334-26.178-63.652-51.761-98.155-73.171-18.444-11.902-42.243-19.637-61.869-29.745-7.139-3.573-19.043-5.357-23.199-11.308-10.713-13.087-16.657-30.334-24.393-45.806-17.249-32.722-33.913-69.007-48.783-103.511-10.707-23.203-17.249-46.404-30.334-67.821-61.28-101.133-127.904-162.403-230.228-222.494-22.017-12.492-48.19-17.847-76.15-24.388-14.87-0.595-29.741-1.785-44.614-2.38-9.52-4.165-19.037-15.47-27.367-20.821-33.908-21.417-121.355-67.822-146.343-6.546-16.064 38.67 23.794 76.738 37.479 96.375 10.114 13.682 23.199 29.147 30.34 44.615 4.162 10.108 5.353 20.821 9.52 31.529 9.513 26.173 18.437 55.323 30.934 79.717 6.541 12.492 13.682 25.579 22.011 36.88 4.757 6.546 13.084 9.519 14.87 20.226-8.329 11.898-8.925 29.745-13.685 44.62-21.412 67.221-13.081 150.507 17.253 199.884 9.519 14.87 32.129 47.595 62.464 35.097 26.772-10.707 20.822-44.615 28.556-74.362 1.785-7.139 0.595-11.897 4.162-16.653v1.189c8.334 16.654 16.658 32.718 24.393 49.377 18.444 29.147 50.567 59.487 77.334 79.717 14.282 10.703 25.583 29.147 43.43 35.692v-1.789h-1.189c-3.573-5.353-8.925-7.731-13.682-11.898-10.711-10.707-22.61-23.794-30.939-35.69-24.983-33.314-46.995-70.198-66.627-108.273-9.519-18.444-17.847-38.67-25.579-57.107-3.572-7.139-3.572-17.847-9.523-21.417-8.925 13.087-22.004 24.388-28.551 40.453-11.301 25.579-12.492 57.106-16.659 89.826-2.384 0.599-1.19 0-2.384 1.189-19.033-4.756-25.579-24.388-32.718-41.049-17.844-42.236-20.822-110.058-5.353-158.835 4.166-12.491 22.016-51.757 14.876-63.652-3.572-11.301-15.47-17.847-22.011-26.772-7.735-11.302-16.064-25.579-21.417-38.075-14.282-33.31-21.421-70.194-36.885-103.511-7.139-15.465-19.632-31.53-29.745-45.805-11.301-16.060-23.794-27.367-32.718-46.405-2.973-6.541-7.139-17.249-2.379-24.388 1.189-4.757 3.568-6.541 8.33-7.735 7.73-6.546 29.744 1.785 37.475 5.353 22.011 8.925 40.453 17.253 58.896 29.745 8.325 5.951 17.249 17.253 27.957 20.226h12.496c19.037 4.166 40.453 1.194 58.297 6.546 31.529 10.114 60.086 24.985 85.669 41.049 77.929 49.377 142.177 119.575 185.606 203.456 7.135 13.682 10.108 26.178 16.658 40.453 12.487 29.152 27.957 58.896 40.448 87.447 12.492 27.962 24.389 56.517 42.237 79.722 8.925 12.487 44.615 19.033 60.679 25.579 11.898 5.353 30.34 10.114 41.049 16.654 20.227 12.492 40.453 26.773 59.491 40.453 9.519 7.139 39.265 22.015 41.049 33.913v0 0zM880.697 737.555z" p-id="974"></path></svg>MySql
            </a-select-option>
            <a-select-option value="Oracle">
              <svg t="1607485470126" style="margin-top: 4px;margin-right: 4px" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1207" width="5%" height="5%"><path d="M700.245333 188.245333h-376.32a323.754667 323.754667 0 0 0-0.341333 647.509334h376.661333a323.754667 323.754667 0 0 0 0-647.509334z m-8.234666 533.418667H332.202667a209.706667 209.706667 0 0 1 0-419.328h359.808a209.664 209.664 0 1 1 0 419.328z" p-id="1208"></path></svg>Oracle
            </a-select-option>
          </a-select>
        </a-form-item>
        <a-form-item label="端口号">
          <a-input v-decorator="['port', {rules: [{required: true, min: 1, message: '此项不能为空'}]}]" />
        </a-form-item>
        <a-form-item label="用户名">
          <a-input v-decorator="['userName', {rules: [{required: true, min: 1, message: '此项不能为空！'}]}]" />
        </a-form-item>
        <a-form-item label="密码">
          <a-input v-decorator="['password', {rules: [{required: true, min: 1, message: '此项不能为空！'}]}]" />
        </a-form-item>
      </a-form>
    </a-spin>
  </a-modal>
</template>

<script>
import pick from 'lodash.pick'

// 表单字段
const fields = ['name', 'id','hostName','databaseName','databaseType','port','userName','password']

export default {
  props: {
    visible: {
      type: Boolean,
      required: true
    },
    loading: {
      type: Boolean,
      default: () => false
    },
    model: {
      type: Object,
      default: () => null
    }
  },
  data () {
    this.formLayout = {
      labelCol: {
        xs: { span: 24 },
        sm: { span: 7 }
      },
      wrapperCol: {
        xs: { span: 24 },
        sm: { span: 13 }
      }
    }
    return {
      form: this.$form.createForm(this)
      // databaseForm:{
      //   id:'',
      //   name:'',
      //   hostName:'',
      //   databaseName:'',
      //   databaseType:'',
      //   port:'',
      //   userName:'',
      //   password:''
      // }
      // ,
      // databaseInfo:[]
    }
  },
  created () {
    console.log('custom modal created')

    // 防止表单未注册
    fields.forEach(v => this.form.getFieldDecorator(v))

    // 当 model 发生改变时，为表单设置值
    this.$watch('model', () => {
      this.model && this.form.setFieldsValue(pick(this.model, fields))
    })
  },
  methods:{
    handleChange(value) {
      console.log(value); // { key: "lucy", label: "Lucy (101)" }
    },
  }
}
</script>
